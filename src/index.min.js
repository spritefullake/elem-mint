module.exports=exports=$E=function(e){return $E.mint(e)},$E.removeSection=function(e,t,r){var n=e.slice(t,r);return e=e.replace(n,"")},$E.findAttrs=function(e){var t=e.slice(e.indexOf("["),e.indexOf("]")+1).replace("[","").replace("]","").split("=");return t},$E.mint=function(e){e=e.replace(/\s+/g,""),e=e.split(",");for(var t=[],r=0,n=e.length;n>r;r++){var i,a,l,p,c,s=e[r],d="",o=[];s=s.replace(/\+/g,"[samelevelchildas=true],");for(var f=function(){var e=s.indexOf(":"),t=s.replace(":","!"),r=t.indexOf(":"),n=r-e>1?parseInt(s.slice(e+1,r)):1;s=s.replace(":","[nextstepsupalevel="+n+"]"),1==n&&(n=""),s=s.replace(n.toString()+":",",")};s.search(/:/)>=0;)f();if(s.indexOf(">")>=0){var u=s.replace(">",","),v=$E.mint(u);v=[].concat.apply([],v);var m=0;v.reduce(function(e,t,r,n){if(parseInt(e.getAttribute("nextstepsupalevel"))>0){for(var i=e.parentNode,a=0,l=parseInt(e.getAttribute("nextstepsupalevel"));l>a;a++)i=i.parentNode;e.removeAttribute("nextstepsupalevel"),i.appendChild(t),m++}return"true"==e.getAttribute("samelevelchildas")?(e.parentNode.appendChild(t),e.removeAttribute("samelevelchildas")):0==m&&e.appendChild(t),m=0,t});for(var h=0,x=v.length;x>h;h++)t.push(v[h])}else{for(;s.indexOf("[")>=0;)o.push($E.findAttrs(s)),s=$E.removeSection(s,s.indexOf("["),s.indexOf("]")+1);if(s.indexOf("#")>=0){l=s.slice(s.indexOf("#")+1).search(/([:.[])/);var g=s.split("#")[0].length;-1==l&&(l=s.length-1),l=g+l+1,a=s.slice(s.indexOf("#")+1,l),s=$E.removeSection(s,s.indexOf("#"),l)}else a="";i=s.split("."),p=i.shift();for(var E=0,O=i.length;O>E;E++)d+=i[E],d+=" ";o=[].concat.apply([],o),d=d.trim(),c=document.createElement(p),c.id=a,c.className=d;for(var $=0,A=o.length;A>$;$++)$%2==0&&c.setAttribute(o[$],o[$+1]);t.push(c)}}return t},$E.render=function(e,t){t=t||document.body,"string"==typeof t&&(t=document.querySelector(t));for(var r=$E.mint(e),n=document.createDocumentFragment(),i=0,a=r.length;a>i;i++)r.indexOf(r[i].parentNode)>-1||n.appendChild(r[i]);t.appendChild(n)},window.$E=$E;